"use strict";module.exports = validate20;module.exports.default = validate20;const schema31 = {"$schema":"https://json-schema.org/draft/2020-12/schema","title":"Peek-Then-Pay Forensic Manifest","description":"Schema for the JWS payload structure carried in X-PTP-Delivery header for audit trails and compliance verification","type":"object","properties":{"schema_version":{"type":"string","const":"1.0","description":"Schema version for future evolution compatibility"},"manifest_id":{"type":"string","pattern":"^[0-9A-HJKMNP-TV-Z]{26}$","description":"Unique manifest identifier in ULID format for replay resistance and auditing"},"publisher_id":{"type":"string","pattern":"^[0-9A-HJKMNP-TV-Z]{26}$","description":"Publisher identifier in ULID format"},"license_id":{"oneOf":[{"type":"string","pattern":"^[0-9A-HJKMNP-TV-Z]{26}$"},{"type":"null"}],"description":"License identifier in ULID format, null for public preview responses"},"resource_url":{"type":"string","format":"uri","description":"Canonical resource URL being served (full URL with scheme)"},"resource_type":{"$ref":"common-defs.schema.json#/$defs/contentType"},"payload_digest":{"type":"string","pattern":"^sha256:[a-fA-F0-9]{64}$","description":"SHA256 digest of the response payload in format sha256:<hex>, must match X-PTP-Payload-Digest header"},"preview":{"type":"boolean","description":"true for preview content, false for full licensed content"},"issued_at":{"type":"string","format":"date-time","description":"RFC 3339 / ISO 8601 datetime when this manifest was issued (MUST be UTC)"},"expires_at":{"type":"string","format":"date-time","description":"RFC 3339 / ISO 8601 datetime when this content/license expires (MUST be UTC)"},"content_ttl_seconds":{"type":"integer","minimum":0,"description":"Time-to-live for this specific content response in seconds (for cache management)"},"signer":{"type":"object","properties":{"kid":{"type":"string","description":"Key ID used to sign this manifest (for JWS header kid reference)"},"entity":{"type":"string","description":"Signer entity identifier (publisher, CDN, enforcement service, etc.)"}},"required":["kid","entity"],"additionalProperties":false,"description":"JWS signer identification"},"model":{"$ref":"common-defs.schema.json#/$defs/modelMetadata","description":"Processing model information for audit trails when content transformation was applied"}},"required":["schema_version","manifest_id","publisher_id","license_id","resource_url","payload_digest","preview","issued_at"],"additionalProperties":false,"examples":[{"schema_version":"1.0","manifest_id":"01HQ2Z3Y4K5M6N7P8Q9R0S1T3Z","publisher_id":"01HQ2Z3Y4K5M6N7P8Q9R0S1T1X","license_id":"01HQ2Z3Y4K5M6N7P8Q9R0S1T2Y","resource_url":"https://example.com/articles/ai-licensing-guide","resource_type":"article","payload_digest":"sha256:f933170deedab22606e857712501415cbedcef68143df05583c6e23b8c0dd7bb","preview":false,"issued_at":"2025-10-14T12:00:00Z","expires_at":"2025-10-14T13:00:00Z","content_ttl_seconds":3600,"signer":{"kid":"publisher-signing-key-001","entity":"example-publisher"},"model":{"provider":"openai","id":"gpt-4","version":"gpt-4-0613","digest":"sha256:7ac5170dd6cc43d9c01a042f12b62598a301201cef596610a87c23474de63065"}},{"schema_version":"1.0","manifest_id":"01HQ2Z3Y4K5M6N7P8Q9R0S1T4A","publisher_id":"01HQ2Z3Y4K5M6N7P8Q9R0S1T1X","license_id":null,"resource_url":"https://example.com/articles/ai-licensing-guide","resource_type":"article","payload_digest":"sha256:a829d77f5a875292d560ae3b176ddd8b428e7f546a880b3f7bf421ba6a475329","preview":true,"issued_at":"2025-10-14T12:00:00Z","expires_at":"2025-10-14T12:05:00Z","content_ttl_seconds":300,"signer":{"kid":"publisher-signing-key-001","entity":"example-publisher"}}]};const schema33 = {"type":"string","description":"High-level classification for routing.","enum":["article","blog","doc","news","video","audio","dataset","other"]};const schema34 = {"type":"object","description":"Model information for AI-generated content.","properties":{"id":{"type":"string","description":"Model identifier"},"provider":{"type":"string","description":"Model provider (e.g., 'openai', 'anthropic', 'google', 'meta', 'mistral', 'cohere')"},"name":{"type":"string","description":"Model name"},"version":{"type":"string","description":"Model version"},"digest":{"type":"string","pattern":"^sha256:[a-fA-F0-9]{64}$","description":"SHA256 digest of model"}},"required":["id","provider","name","version","digest"],"additionalProperties":false};const func1 = Object.prototype.hasOwnProperty;const pattern4 = new RegExp("^[0-9A-HJKMNP-TV-Z]{26}$", "u");const pattern7 = new RegExp("^sha256:[a-fA-F0-9]{64}$", "u");const formats0 = require("ajv-formats/dist/formats").fullFormats.uri;const formats2 = require("ajv-formats/dist/formats").fullFormats["date-time"];function validate20(data, {instancePath="", parentData, parentDataProperty, rootData=data, dynamicAnchors={}}={}){let vErrors = null;let errors = 0;const evaluated0 = validate20.evaluated;if(evaluated0.dynamicProps){evaluated0.props = undefined;}if(evaluated0.dynamicItems){evaluated0.items = undefined;}if(data && typeof data == "object" && !Array.isArray(data)){if(data.schema_version === undefined){const err0 = {instancePath,schemaPath:"#/required",keyword:"required",params:{missingProperty: "schema_version"},message:"must have required property '"+"schema_version"+"'"};if(vErrors === null){vErrors = [err0];}else {vErrors.push(err0);}errors++;}if(data.manifest_id === undefined){const err1 = {instancePath,schemaPath:"#/required",keyword:"required",params:{missingProperty: "manifest_id"},message:"must have required property '"+"manifest_id"+"'"};if(vErrors === null){vErrors = [err1];}else {vErrors.push(err1);}errors++;}if(data.publisher_id === undefined){const err2 = {instancePath,schemaPath:"#/required",keyword:"required",params:{missingProperty: "publisher_id"},message:"must have required property '"+"publisher_id"+"'"};if(vErrors === null){vErrors = [err2];}else {vErrors.push(err2);}errors++;}if(data.license_id === undefined){const err3 = {instancePath,schemaPath:"#/required",keyword:"required",params:{missingProperty: "license_id"},message:"must have required property '"+"license_id"+"'"};if(vErrors === null){vErrors = [err3];}else {vErrors.push(err3);}errors++;}if(data.resource_url === undefined){const err4 = {instancePath,schemaPath:"#/required",keyword:"required",params:{missingProperty: "resource_url"},message:"must have required property '"+"resource_url"+"'"};if(vErrors === null){vErrors = [err4];}else {vErrors.push(err4);}errors++;}if(data.payload_digest === undefined){const err5 = {instancePath,schemaPath:"#/required",keyword:"required",params:{missingProperty: "payload_digest"},message:"must have required property '"+"payload_digest"+"'"};if(vErrors === null){vErrors = [err5];}else {vErrors.push(err5);}errors++;}if(data.preview === undefined){const err6 = {instancePath,schemaPath:"#/required",keyword:"required",params:{missingProperty: "preview"},message:"must have required property '"+"preview"+"'"};if(vErrors === null){vErrors = [err6];}else {vErrors.push(err6);}errors++;}if(data.issued_at === undefined){const err7 = {instancePath,schemaPath:"#/required",keyword:"required",params:{missingProperty: "issued_at"},message:"must have required property '"+"issued_at"+"'"};if(vErrors === null){vErrors = [err7];}else {vErrors.push(err7);}errors++;}for(const key0 in data){if(!(func1.call(schema31.properties, key0))){const err8 = {instancePath,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty: key0},message:"must NOT have additional properties"};if(vErrors === null){vErrors = [err8];}else {vErrors.push(err8);}errors++;}}if(data.schema_version !== undefined){let data0 = data.schema_version;if(typeof data0 !== "string"){const err9 = {instancePath:instancePath+"/schema_version",schemaPath:"#/properties/schema_version/type",keyword:"type",params:{type: "string"},message:"must be string"};if(vErrors === null){vErrors = [err9];}else {vErrors.push(err9);}errors++;}if("1.0" !== data0){const err10 = {instancePath:instancePath+"/schema_version",schemaPath:"#/properties/schema_version/const",keyword:"const",params:{allowedValue: "1.0"},message:"must be equal to constant"};if(vErrors === null){vErrors = [err10];}else {vErrors.push(err10);}errors++;}}if(data.manifest_id !== undefined){let data1 = data.manifest_id;if(typeof data1 === "string"){if(!pattern4.test(data1)){const err11 = {instancePath:instancePath+"/manifest_id",schemaPath:"#/properties/manifest_id/pattern",keyword:"pattern",params:{pattern: "^[0-9A-HJKMNP-TV-Z]{26}$"},message:"must match pattern \""+"^[0-9A-HJKMNP-TV-Z]{26}$"+"\""};if(vErrors === null){vErrors = [err11];}else {vErrors.push(err11);}errors++;}}else {const err12 = {instancePath:instancePath+"/manifest_id",schemaPath:"#/properties/manifest_id/type",keyword:"type",params:{type: "string"},message:"must be string"};if(vErrors === null){vErrors = [err12];}else {vErrors.push(err12);}errors++;}}if(data.publisher_id !== undefined){let data2 = data.publisher_id;if(typeof data2 === "string"){if(!pattern4.test(data2)){const err13 = {instancePath:instancePath+"/publisher_id",schemaPath:"#/properties/publisher_id/pattern",keyword:"pattern",params:{pattern: "^[0-9A-HJKMNP-TV-Z]{26}$"},message:"must match pattern \""+"^[0-9A-HJKMNP-TV-Z]{26}$"+"\""};if(vErrors === null){vErrors = [err13];}else {vErrors.push(err13);}errors++;}}else {const err14 = {instancePath:instancePath+"/publisher_id",schemaPath:"#/properties/publisher_id/type",keyword:"type",params:{type: "string"},message:"must be string"};if(vErrors === null){vErrors = [err14];}else {vErrors.push(err14);}errors++;}}if(data.license_id !== undefined){let data3 = data.license_id;const _errs9 = errors;let valid1 = false;let passing0 = null;const _errs10 = errors;if(typeof data3 === "string"){if(!pattern4.test(data3)){const err15 = {instancePath:instancePath+"/license_id",schemaPath:"#/properties/license_id/oneOf/0/pattern",keyword:"pattern",params:{pattern: "^[0-9A-HJKMNP-TV-Z]{26}$"},message:"must match pattern \""+"^[0-9A-HJKMNP-TV-Z]{26}$"+"\""};if(vErrors === null){vErrors = [err15];}else {vErrors.push(err15);}errors++;}}else {const err16 = {instancePath:instancePath+"/license_id",schemaPath:"#/properties/license_id/oneOf/0/type",keyword:"type",params:{type: "string"},message:"must be string"};if(vErrors === null){vErrors = [err16];}else {vErrors.push(err16);}errors++;}var _valid0 = _errs10 === errors;if(_valid0){valid1 = true;passing0 = 0;}const _errs12 = errors;if(data3 !== null){const err17 = {instancePath:instancePath+"/license_id",schemaPath:"#/properties/license_id/oneOf/1/type",keyword:"type",params:{type: "null"},message:"must be null"};if(vErrors === null){vErrors = [err17];}else {vErrors.push(err17);}errors++;}var _valid0 = _errs12 === errors;if(_valid0 && valid1){valid1 = false;passing0 = [passing0, 1];}else {if(_valid0){valid1 = true;passing0 = 1;}}if(!valid1){const err18 = {instancePath:instancePath+"/license_id",schemaPath:"#/properties/license_id/oneOf",keyword:"oneOf",params:{passingSchemas: passing0},message:"must match exactly one schema in oneOf"};if(vErrors === null){vErrors = [err18];}else {vErrors.push(err18);}errors++;}else {errors = _errs9;if(vErrors !== null){if(_errs9){vErrors.length = _errs9;}else {vErrors = null;}}}}if(data.resource_url !== undefined){let data4 = data.resource_url;if(typeof data4 === "string"){if(!(formats0(data4))){const err19 = {instancePath:instancePath+"/resource_url",schemaPath:"#/properties/resource_url/format",keyword:"format",params:{format: "uri"},message:"must match format \""+"uri"+"\""};if(vErrors === null){vErrors = [err19];}else {vErrors.push(err19);}errors++;}}else {const err20 = {instancePath:instancePath+"/resource_url",schemaPath:"#/properties/resource_url/type",keyword:"type",params:{type: "string"},message:"must be string"};if(vErrors === null){vErrors = [err20];}else {vErrors.push(err20);}errors++;}}if(data.resource_type !== undefined){let data5 = data.resource_type;if(typeof data5 !== "string"){const err21 = {instancePath:instancePath+"/resource_type",schemaPath:"common-defs.schema.json#/$defs/contentType/type",keyword:"type",params:{type: "string"},message:"must be string"};if(vErrors === null){vErrors = [err21];}else {vErrors.push(err21);}errors++;}if(!((((((((data5 === "article") || (data5 === "blog")) || (data5 === "doc")) || (data5 === "news")) || (data5 === "video")) || (data5 === "audio")) || (data5 === "dataset")) || (data5 === "other"))){const err22 = {instancePath:instancePath+"/resource_type",schemaPath:"common-defs.schema.json#/$defs/contentType/enum",keyword:"enum",params:{allowedValues: schema33.enum},message:"must be equal to one of the allowed values"};if(vErrors === null){vErrors = [err22];}else {vErrors.push(err22);}errors++;}}if(data.payload_digest !== undefined){let data6 = data.payload_digest;if(typeof data6 === "string"){if(!pattern7.test(data6)){const err23 = {instancePath:instancePath+"/payload_digest",schemaPath:"#/properties/payload_digest/pattern",keyword:"pattern",params:{pattern: "^sha256:[a-fA-F0-9]{64}$"},message:"must match pattern \""+"^sha256:[a-fA-F0-9]{64}$"+"\""};if(vErrors === null){vErrors = [err23];}else {vErrors.push(err23);}errors++;}}else {const err24 = {instancePath:instancePath+"/payload_digest",schemaPath:"#/properties/payload_digest/type",keyword:"type",params:{type: "string"},message:"must be string"};if(vErrors === null){vErrors = [err24];}else {vErrors.push(err24);}errors++;}}if(data.preview !== undefined){if(typeof data.preview !== "boolean"){const err25 = {instancePath:instancePath+"/preview",schemaPath:"#/properties/preview/type",keyword:"type",params:{type: "boolean"},message:"must be boolean"};if(vErrors === null){vErrors = [err25];}else {vErrors.push(err25);}errors++;}}if(data.issued_at !== undefined){let data8 = data.issued_at;if(typeof data8 === "string"){if(!(formats2.validate(data8))){const err26 = {instancePath:instancePath+"/issued_at",schemaPath:"#/properties/issued_at/format",keyword:"format",params:{format: "date-time"},message:"must match format \""+"date-time"+"\""};if(vErrors === null){vErrors = [err26];}else {vErrors.push(err26);}errors++;}}else {const err27 = {instancePath:instancePath+"/issued_at",schemaPath:"#/properties/issued_at/type",keyword:"type",params:{type: "string"},message:"must be string"};if(vErrors === null){vErrors = [err27];}else {vErrors.push(err27);}errors++;}}if(data.expires_at !== undefined){let data9 = data.expires_at;if(typeof data9 === "string"){if(!(formats2.validate(data9))){const err28 = {instancePath:instancePath+"/expires_at",schemaPath:"#/properties/expires_at/format",keyword:"format",params:{format: "date-time"},message:"must match format \""+"date-time"+"\""};if(vErrors === null){vErrors = [err28];}else {vErrors.push(err28);}errors++;}}else {const err29 = {instancePath:instancePath+"/expires_at",schemaPath:"#/properties/expires_at/type",keyword:"type",params:{type: "string"},message:"must be string"};if(vErrors === null){vErrors = [err29];}else {vErrors.push(err29);}errors++;}}if(data.content_ttl_seconds !== undefined){let data10 = data.content_ttl_seconds;if(!((typeof data10 == "number") && (!(data10 % 1) && !isNaN(data10)))){const err30 = {instancePath:instancePath+"/content_ttl_seconds",schemaPath:"#/properties/content_ttl_seconds/type",keyword:"type",params:{type: "integer"},message:"must be integer"};if(vErrors === null){vErrors = [err30];}else {vErrors.push(err30);}errors++;}if(typeof data10 == "number"){if(data10 < 0 || isNaN(data10)){const err31 = {instancePath:instancePath+"/content_ttl_seconds",schemaPath:"#/properties/content_ttl_seconds/minimum",keyword:"minimum",params:{comparison: ">=", limit: 0},message:"must be >= 0"};if(vErrors === null){vErrors = [err31];}else {vErrors.push(err31);}errors++;}}}if(data.signer !== undefined){let data11 = data.signer;if(data11 && typeof data11 == "object" && !Array.isArray(data11)){if(data11.kid === undefined){const err32 = {instancePath:instancePath+"/signer",schemaPath:"#/properties/signer/required",keyword:"required",params:{missingProperty: "kid"},message:"must have required property '"+"kid"+"'"};if(vErrors === null){vErrors = [err32];}else {vErrors.push(err32);}errors++;}if(data11.entity === undefined){const err33 = {instancePath:instancePath+"/signer",schemaPath:"#/properties/signer/required",keyword:"required",params:{missingProperty: "entity"},message:"must have required property '"+"entity"+"'"};if(vErrors === null){vErrors = [err33];}else {vErrors.push(err33);}errors++;}for(const key1 in data11){if(!((key1 === "kid") || (key1 === "entity"))){const err34 = {instancePath:instancePath+"/signer",schemaPath:"#/properties/signer/additionalProperties",keyword:"additionalProperties",params:{additionalProperty: key1},message:"must NOT have additional properties"};if(vErrors === null){vErrors = [err34];}else {vErrors.push(err34);}errors++;}}if(data11.kid !== undefined){if(typeof data11.kid !== "string"){const err35 = {instancePath:instancePath+"/signer/kid",schemaPath:"#/properties/signer/properties/kid/type",keyword:"type",params:{type: "string"},message:"must be string"};if(vErrors === null){vErrors = [err35];}else {vErrors.push(err35);}errors++;}}if(data11.entity !== undefined){if(typeof data11.entity !== "string"){const err36 = {instancePath:instancePath+"/signer/entity",schemaPath:"#/properties/signer/properties/entity/type",keyword:"type",params:{type: "string"},message:"must be string"};if(vErrors === null){vErrors = [err36];}else {vErrors.push(err36);}errors++;}}}else {const err37 = {instancePath:instancePath+"/signer",schemaPath:"#/properties/signer/type",keyword:"type",params:{type: "object"},message:"must be object"};if(vErrors === null){vErrors = [err37];}else {vErrors.push(err37);}errors++;}}if(data.model !== undefined){let data14 = data.model;if(data14 && typeof data14 == "object" && !Array.isArray(data14)){if(data14.id === undefined){const err38 = {instancePath:instancePath+"/model",schemaPath:"common-defs.schema.json#/$defs/modelMetadata/required",keyword:"required",params:{missingProperty: "id"},message:"must have required property '"+"id"+"'"};if(vErrors === null){vErrors = [err38];}else {vErrors.push(err38);}errors++;}if(data14.provider === undefined){const err39 = {instancePath:instancePath+"/model",schemaPath:"common-defs.schema.json#/$defs/modelMetadata/required",keyword:"required",params:{missingProperty: "provider"},message:"must have required property '"+"provider"+"'"};if(vErrors === null){vErrors = [err39];}else {vErrors.push(err39);}errors++;}if(data14.name === undefined){const err40 = {instancePath:instancePath+"/model",schemaPath:"common-defs.schema.json#/$defs/modelMetadata/required",keyword:"required",params:{missingProperty: "name"},message:"must have required property '"+"name"+"'"};if(vErrors === null){vErrors = [err40];}else {vErrors.push(err40);}errors++;}if(data14.version === undefined){const err41 = {instancePath:instancePath+"/model",schemaPath:"common-defs.schema.json#/$defs/modelMetadata/required",keyword:"required",params:{missingProperty: "version"},message:"must have required property '"+"version"+"'"};if(vErrors === null){vErrors = [err41];}else {vErrors.push(err41);}errors++;}if(data14.digest === undefined){const err42 = {instancePath:instancePath+"/model",schemaPath:"common-defs.schema.json#/$defs/modelMetadata/required",keyword:"required",params:{missingProperty: "digest"},message:"must have required property '"+"digest"+"'"};if(vErrors === null){vErrors = [err42];}else {vErrors.push(err42);}errors++;}for(const key2 in data14){if(!(((((key2 === "id") || (key2 === "provider")) || (key2 === "name")) || (key2 === "version")) || (key2 === "digest"))){const err43 = {instancePath:instancePath+"/model",schemaPath:"common-defs.schema.json#/$defs/modelMetadata/additionalProperties",keyword:"additionalProperties",params:{additionalProperty: key2},message:"must NOT have additional properties"};if(vErrors === null){vErrors = [err43];}else {vErrors.push(err43);}errors++;}}if(data14.id !== undefined){if(typeof data14.id !== "string"){const err44 = {instancePath:instancePath+"/model/id",schemaPath:"common-defs.schema.json#/$defs/modelMetadata/properties/id/type",keyword:"type",params:{type: "string"},message:"must be string"};if(vErrors === null){vErrors = [err44];}else {vErrors.push(err44);}errors++;}}if(data14.provider !== undefined){if(typeof data14.provider !== "string"){const err45 = {instancePath:instancePath+"/model/provider",schemaPath:"common-defs.schema.json#/$defs/modelMetadata/properties/provider/type",keyword:"type",params:{type: "string"},message:"must be string"};if(vErrors === null){vErrors = [err45];}else {vErrors.push(err45);}errors++;}}if(data14.name !== undefined){if(typeof data14.name !== "string"){const err46 = {instancePath:instancePath+"/model/name",schemaPath:"common-defs.schema.json#/$defs/modelMetadata/properties/name/type",keyword:"type",params:{type: "string"},message:"must be string"};if(vErrors === null){vErrors = [err46];}else {vErrors.push(err46);}errors++;}}if(data14.version !== undefined){if(typeof data14.version !== "string"){const err47 = {instancePath:instancePath+"/model/version",schemaPath:"common-defs.schema.json#/$defs/modelMetadata/properties/version/type",keyword:"type",params:{type: "string"},message:"must be string"};if(vErrors === null){vErrors = [err47];}else {vErrors.push(err47);}errors++;}}if(data14.digest !== undefined){let data19 = data14.digest;if(typeof data19 === "string"){if(!pattern7.test(data19)){const err48 = {instancePath:instancePath+"/model/digest",schemaPath:"common-defs.schema.json#/$defs/modelMetadata/properties/digest/pattern",keyword:"pattern",params:{pattern: "^sha256:[a-fA-F0-9]{64}$"},message:"must match pattern \""+"^sha256:[a-fA-F0-9]{64}$"+"\""};if(vErrors === null){vErrors = [err48];}else {vErrors.push(err48);}errors++;}}else {const err49 = {instancePath:instancePath+"/model/digest",schemaPath:"common-defs.schema.json#/$defs/modelMetadata/properties/digest/type",keyword:"type",params:{type: "string"},message:"must be string"};if(vErrors === null){vErrors = [err49];}else {vErrors.push(err49);}errors++;}}}else {const err50 = {instancePath:instancePath+"/model",schemaPath:"common-defs.schema.json#/$defs/modelMetadata/type",keyword:"type",params:{type: "object"},message:"must be object"};if(vErrors === null){vErrors = [err50];}else {vErrors.push(err50);}errors++;}}}else {const err51 = {instancePath,schemaPath:"#/type",keyword:"type",params:{type: "object"},message:"must be object"};if(vErrors === null){vErrors = [err51];}else {vErrors.push(err51);}errors++;}validate20.errors = vErrors;return errors === 0;}validate20.evaluated = {"props":true,"dynamicProps":false,"dynamicItems":false};